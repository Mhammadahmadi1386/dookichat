سلام
وبسایتی پیام رسان دارم که میخوام در توسعه ان به من کمک کنی

سرورم را با  XAMPP  ساختم

کد های سایتم:


کد ساخت تیبل در دیتا بیس:

CREATE TABLE messages (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    message TEXT,
    file_path VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


chat.html به شرح زیر:



<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>چت آنلاین</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            direction: rtl; /* راست‌چین کردن متن */
        }
        h1 {
            text-align: center;
            color: #333;
        }
        #chat-box {
            height: 600px; /* افزایش ارتفاع چت باکس */
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            text-align: right; /* راست‌چین کردن متن در چت باکس */
        }
        #message-form {
            display: flex;
            justify-content: space-between;
            align-items: center; /* تراز کردن عمودی */
        }
        #message {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-left: 10px; /* تغییر به margin-left برای راست‌چین کردن */
            height: 40px; /* افزایش ارتفاع ورودی پیام */
        }
        .file-upload {
            position: relative;
            overflow: hidden;
            margin-left: 10px; /* فاصله از ورودی پیام */
        }
        .file-upload input[type="file"] {
            position: absolute;
            top: 0;
            right: 0;
            opacity: 0; /* مخفی کردن ورودی فایل */
            height: 100%;
            width: 100%;
            cursor: pointer;
        }
        .file-upload button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .file-upload button:hover {
            background-color: #0056b3;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        #progress-container {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 5px;
            margin-top: 10px;
            display: none; /* مخفی کردن نوار پیشرفت در ابتدا */
        }
        #progress {
            height: 20px;
            width: 0;
            background-color: #4caf50;
            border-radius: 5px;
        }
        #username-container {
            margin-bottom: 10px;
            text-align: center;
        }
        input[type="text"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: calc(100% - 22px);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>چت آنلاین</h1>
    <div id="username-container">
        <input type="text" id="username" placeholder="نام کاربری" required>
        <button id="set-username">تایید نام کاربری</button>
        <button id="edit-username" style="display: none;">ویرایش نام کاربری</button>
    </div>
    <button id="clear-history">پاک کردن تاریخچه</button> <!-- دکمه پاک کردن تاریخچه -->
    <div id="chat-box"></div>
    <form id="message-form" enctype="multipart/form-data">
        <input type="text" id="message" placeholder="پیام (اختیاری)">
        <div class="file-upload">
            <button type="button">انتخاب فایل</button>
            <input type="file" id="file" accept="*"> <!-- اجازه ارسال هر نوع فایلی -->
        </div>
        <button type="submit">ارسال</button>
    </form>
    <div id="progress-container">
        <div id="progress"></div>
    </div>

    <script src="chat.js"></script> <!-- ارجاع به فایل جاوااسکریپت -->
</body>
</html>




load_messages.php به شرح زیر:




<?php
$conn = new mysqli('localhost', 'root', '', 'chat_app');

if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

$result = $conn->query("SELECT * FROM messages ORDER BY created_at DESC LIMIT 50");
$messages = [];
while ($row = $result->fetch_assoc()) {
    $messages[] = $row;
}
echo json_encode(array_reverse($messages));
$conn->close();
?>





send_message.php به شرح زیر:



<?php
$conn = new mysqli('localhost', 'root', '', 'chat_app');

if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

$data = $_POST;
$username = $conn->real_escape_string($data['username']);
$message = $conn->real_escape_string($data['message']);
$filePath = '';

if (isset($_FILES['file']) && $_FILES['file']['error'] == 0) {
    $targetDir = "uploads/";
    $fileName = basename($_FILES['file']['name']);
    $filePath = $targetDir . uniqid() . '_' . $fileName;

    if (!is_dir($targetDir)) {
        mkdir($targetDir, 0777, true);
    }

    if (move_uploaded_file($_FILES['file']['tmp_name'], $filePath)) {
        // فایل با موفقیت آپلود شد
    } else {
        echo json_encode(["error" => "خطا در آپلود فایل."]);
        exit;
    }
}

$stmt = $conn->prepare("INSERT INTO messages (username, message, file_path) VALUES (?, ?, ?)");
$stmt->bind_param("sss", $username, $message, $filePath);

if ($stmt->execute()) {
    echo json_encode(["success" => "پیام با موفقیت ارسال شد."]);
} else {
    echo json_encode(["error" => "خطا در ارسال پیام: " . $stmt->error]);
}

$stmt->close();
$conn->close();
?>





clear_history.php به شرح زیر:





<?php
$conn = new mysqli('localhost', 'root', '', 'chat_app');

if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// پاک کردن تمام پیام‌ها از جدول messages
$conn->query("DELETE FROM messages");
$conn->close();
?>






chat.js به شرح زیر:
const chatBox = document.getElementById('chat-box');
const messageForm = document.getElementById('message-form');
const usernameInput = document.getElementById('username');
const usernameContainer = document.getElementById('username-container');
const setUsernameButton = document.getElementById('set-username');
const editUsernameButton = document.getElementById('edit-username');
const clearHistoryButton = document.getElementById('clear-history');
const progressContainer = document.getElementById('progress-container');
const progressBar = document.getElementById('progress');

if (localStorage.getItem('username')) {
    usernameInput.value = localStorage.getItem('username');
    usernameContainer.style.display = 'none';
    editUsernameButton.style.display = 'inline';
}

setUsernameButton.addEventListener('click', function() {
    const username = usernameInput.value;
    if (username) {
        localStorage.setItem('username', username);
        usernameContainer.style.display = 'none';
        editUsernameButton.style.display = 'inline';
    }
});

editUsernameButton.addEventListener('click', function() {
    usernameContainer.style.display = 'block'; // نمایش باکس نام کاربری
    usernameInput.value = localStorage.getItem('username'); // بارگذاری نام کاربری
    editUsernameButton.style.display = 'none'; // مخفی کردن دکمه ویرایش
});

function loadMessages() {
    fetch('load_messages.php')
        .then(response => response.json())
        .then(data => {
            chatBox.innerHTML = '';
            data.forEach(msg => {
                let messageContent = `<div class="message"><strong>${msg.username}:</strong> ${msg.message}</div>`;
                if (msg.file_path) {
                    messageContent += `
                        <a href="${msg.file_path}" class="download-link" download>دانلود فایل</a>
                        <img src="${msg.file_path}" style="max-width: 200px; display: block;">`;
                }
                chatBox.innerHTML += messageContent;
            });
            chatBox.scrollTop = chatBox.scrollHeight; // اسکرول به پایین چت باکس
        });
}

messageForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const username = localStorage.getItem('username');
    const message = document.getElementById('message').value;
    const file = document.getElementById('file').files[0];

    const formData = new FormData();
    formData.append('username', username);
    formData.append('message', message);
    if (file) {
        formData.append('file', file);
    }

    // نمایش نوار پیشرفت
    progressContainer.style.display = 'block';
    progressBar.style.width = '0%'; // Reset progress bar

    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'send_message.php', true);

    // Update progress bar
    xhr.upload.addEventListener('progress', function(e) {
        if (e.lengthComputable) {
            const percentComplete = (e.loaded / e.total) * 100;
            progressBar.style.width = percentComplete + '%';
        }
    });

    xhr.onload = function() {
        if (xhr.status === 200) {
            document.getElementById('message').value = ''; // پاک کردن ورودی پیام
            document.getElementById('file').value = ''; // پاک کردن ورودی فایل
            loadMessages(); // بارگذاری مجدد پیام‌ها
            progressContainer.style.display = 'none'; // مخفی کردن نوار پیشرفت
        } else {
            alert('خطا در ارسال پیام.');
        }
    };

    xhr.send(formData);
});

clearHistoryButton.addEventListener('click', function() {
    if (confirm("آیا مطمئن هستید که می‌خواهید تاریخچه چت را پاک کنید؟")) {
        fetch('clear_history.php', {
            method: 'POST'
        }).then(() => {
            chatBox.innerHTML = ''; // پاک کردن چت باکس
        });
    }
});

setInterval(loadMessages, 2000); // هر 2 ثانیه پیام‌ها را بارگذاری کن
loadMessages(); // بارگذاری اولیه پیام‌ها
